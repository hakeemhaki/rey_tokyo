!function(e){"use strict";var t=function(t){this.cookie_key="rey_compare_ids_"+e.reyHelpers.params.site_id,this.logged_in=e("body").hasClass("logged-in"),this.isComparePage=e("body.rey-compare-page").length,this.init=function(){this.$compareWrapper=e(".rey-compareWrapper"),this.$siteMain=e("body.rey-compare-page .rey-siteContent"),this.$emptyPage=e(".rey-compare-emptyPage",this.$siteMain),this.scope=t||document,this.setVars(t),this.checkPageIds(),this.cleanupPage(),this.updateCounters(),this.events()},this.setVars=function(){this.$recentBtn=e(".rey-compare-recentBtn",this.scope),this.$recentProducts=e(".rey-compareNotice-recentProducts",this.scope),this.$recentProductsList=e(".rey-compareNotice-recentProducts-inner",this.scope),this.$afterPanel=e(".rey-compareNotice-wrapper",this.scope),this.$panelTitle=e(".rey-compareTitle",this.scope),this.$pageTable=e(".rey-comparePage-table",this.scope),this.$pageTableScroll=e(".rey-comparePage-scroll",this.scope),this.$afterPanel.removeClass("--hidden")},this.events=function(){var t=this;e(document).on("click",".rey-compareBtn",(function(r){r.preventDefault();var a=e(this),o=parseInt(a.attr("data-id")||""),s=t.getProducts(),i=e(".rey-compareBtn-text",a);if(!isNaN(o)){if(a.hasClass("--supports-ajax")&&a.addClass("--doing"),a.hasClass("--in-compare")){var n=s.indexOf(o);if(-1!==n)return t.removeProduct(o,n),a.removeClass("--in-compare"),a.attr({title:e.reyHelpers.params.compare_text_add,"aria-label":e.reyHelpers.params.compare_text_add,"data-tooltip-text":e.reyHelpers.params.compare_text_add}),void(i.length&&i.text(e.reyHelpers.params.compare_text_add))}t.showNotice(),t.setProduct(o),a.addClass("--in-compare"),a.attr({title:e.reyHelpers.params.compare_text_rm,"aria-label":e.reyHelpers.params.compare_text_rm,"data-tooltip-text":e.reyHelpers.params.compare_text_rm}),i.length&&i.text(e.reyHelpers.params.compare_text_rm)}})),this.$recentBtn.on("click",(function(r){r.preventDefault();var a=e(this);if(a.addClass("--disabled"),t.$recentProducts.hasClass("--visible"))return a.removeClass("--disabled"),t.$recentProducts.removeClass("--visible"),void t.$recentProductsList.empty();t.getRecentProducts()})),e(document).on("click",".rey-compare-recentProducts-add",(function(r){r.preventDefault();var a=e(this),o=a.attr("data-id")||"";o&&(t.setProduct(o),a.addClass("--disabled"))})),e(document).on("click",".rey-compare-resetBtn",(function(r){r.preventDefault(),t.removeAll(),t.updateCounters(),t.save(),e(".rey-compareBtn").removeClass("--in-compare"),setTimeout((function(){e(".rey-compareNotice-wrapper").removeClass("--visible")}),1e3)})),e(document).on("click",".rey-compareClose",(function(e){e.preventDefault(),t.hideNotice()})),e(document).on("keyup",(function(e){27==e.keyCode&&t.hideNotice()})),e(document).on("reycore/woocommerce/compare/added_product reycore/woocommerce/compare/removed_product",(function(e,r,a){t.updateCounters(r),t.save(r),t.logged_in||t.animateBtn(a),t.cleanupPage()})),e(document).on("reycore/woocommerce/after_login",(function(e,r){t.getSavedProducts()}))},this.drag_events=function(){if(e.reyHelpers.is_desktop){var t,r,a=this.$pageTableScroll,o=!1;a.on("mousedown",(function(e){o=!0,a.addClass("--active"),t=e.pageX-a.offset().left,r=a[0].scrollLeft})),a.on("mouseleave",(function(){o=!1,a.removeClass("--active")})),a.on("mouseup",(function(){o=!1,a.removeClass("--active")})),a.on("mousemove",(function(e){if(o){e.preventDefault();var s=3*(e.pageX-a.offset().left-t);a.scrollLeft(r-s)}}))}},this.checkPageIds=function(){if(this.isComparePage){var e=this.getProducts();e.length&&(this.$compareWrapper.children().length&&parseInt(this.$pageTable.attr("data-count"))===e.length||this.getComparePageContent())}},this.getComparePageContent=function(){var t=this;(e.reyHelpers.params.ajaxurl||e.reyHelpers.params.ajax_nonce)&&(this.$siteMain.addClass("--loading"),e.ajax({url:e.reyHelpers.params.ajaxurl,dataType:"json",cache:!1,data:{action:"rey_compare_get_page_content",security:e.reyHelpers.params.ajax_nonce},success:function(r){if(r&&(!r||r.success)&&r.data&&t.$siteMain.length){var a=e(r.data),o=t.$compareWrapper.html(a);t.setVars(o),t.drag_events(),t.$siteMain.removeClass("--loading"),t.$compareWrapper.removeClass("--empty"),e(document).on("click",".rey-compare-removeBtn",(function(r){r.preventDefault();var a=e(this),o=parseInt(a.attr("data-id")||""),s=t.getProducts();if(!isNaN(o)){var i=s.indexOf(o);-1!==i&&(t.removeProduct(o,i),e("td[data-id="+o+"], th[data-id="+o+"]",t.$pageTable).remove(),t.cleanupPage())}}))}},error:function(e,t,r){console.error(e),console.error(t),console.error(r)}}))},this.cleanupPage=function(){if(this.isComparePage&&this.$siteMain.length){e(".woocommerce-notices-wrapper, .rey-loopHeader",this.$siteMain).remove();var t=this.getProducts();t.length?(this.$pageTable.attr("data-count",t.length),e.reyHelpers.setProperty("--products-count",t.length,this.$pageTable[0])):this.$compareWrapper.addClass("--empty")}},this.animateBtn=function(t){var r=e(t?".rey-compareBtn[data-id="+t+"]":".rey-compareBtn.--doing");r.addClass("--animate"),this.logged_in&&this.$panelTitle.removeClass("--loading"),setTimeout((function(){r.removeClass("--animate")}),500)},this.showNotice=function(){"notice"===e.reyHelpers.params.compare_after_add&&(this.$afterPanel.addClass("--visible"),this.logged_in&&this.$panelTitle.addClass("--loading"))},this.hideNotice=function(){"notice"===e.reyHelpers.params.compare_after_add&&(this.$afterPanel.removeClass("--visible"),this.$recentProducts.removeClass("--visible"))},this.updateCounters=function(t){t||(t=this.getProducts());var r=e(".rey-compareCounter-number"),a=t.length;a?r.text(a).removeClass("--empty"):r.text("0").addClass("--empty")},this.save=function(t){if(t||(t=this.getProducts()),this.logged_in&&(e.reyHelpers.params.ajaxurl||e.reyHelpers.params.ajax_nonce)){var r=this;e(".rey-compareBtn").addClass("--disabled"),e.ajax({url:e.reyHelpers.params.ajaxurl,dataType:"json",cache:!1,data:{action:"rey_compare_add_to_user_meta",security:e.reyHelpers.params.ajax_nonce},success:function(t){r.animateBtn(),e(".rey-compareBtn").removeClass("--disabled --doing")},error:function(e,t,r){console.error(e),console.error(t),console.error(r)}})}},this.getRecentProducts=function(){if(e.reyHelpers.params.ajaxurl||e.reyHelpers.params.ajax_nonce){var t=this;this.$recentProducts.addClass("--loading --visible"),e.ajax({url:e.reyHelpers.params.ajaxurl,dataType:"json",cache:!1,data:{action:"rey_compare_get_viewed_products",security:e.reyHelpers.params.ajax_nonce},success:function(r){if(r&&r.success&&(t.$recentProducts.removeClass("--loading"),r.data)){var a=t.$recentProductsList.html(r.data),o=t.getProducts();e.each(o,(function(t,r){e(".rey-compare-recentProducts-add[data-id="+r+"]",a).addClass("--disabled")})),"undefined"!=typeof SimpleScrollbar&&SimpleScrollbar.initEl(e(".rey-compare-recentProducts",a)[0])}},error:function(e,t,r){console.error(e),console.error(t),console.error(r)}})}},this.getProducts=function(){if("undefined"!=typeof Cookies){var e=Cookies.get(this.cookie_key);return e?e.split("|").map((function(e){return parseInt(e)})):[]}},this.getSavedProducts=function(){if(e.reyHelpers.params.ajaxurl||e.reyHelpers.params.ajax_nonce){this.logged_in=!0;var t=this;e.ajax({url:e.reyHelpers.params.ajaxurl,dataType:"json",cache:!1,data:{action:"get_compare_data",security:e.reyHelpers.params.ajax_nonce},success:function(r){if(r&&r.success){var a=r.data;if(a.length){var o=a.map((function(e){return e.id}));"undefined"!=typeof Cookies&&(Cookies.set(t.cookie_key,o.join("|")),t.updateCounters(o),e(".rey-compareBtn").removeClass("--supports-ajax --in-compare"),e.each(o,(function(r,a){var o=e(".rey-compareBtn[data-id="+a+"]");o.addClass("--in-compare"),t.logged_in&&o.addClass("--supports-ajax")})),e(document).trigger("reycore/woocommerce/compare/get_saved_products",[a]))}}},error:function(e,t,r){console.error(e),console.error(t),console.error(r)}})}},this.setProduct=function(t){if("undefined"!=typeof Cookies){t=parseInt(t);var r=this.getProducts();-1===r.indexOf(t)&&(r.push(t),Cookies.set(this.cookie_key,r.join("|")),e(document).trigger("reycore/woocommerce/compare/added_product",[r,t]))}},this.removeProduct=function(t,r,a){if("undefined"!=typeof Cookies){t=parseInt(t);var o=this.getProducts();o.splice(r,1),Cookies.set(this.cookie_key,o.join("|")),a||e(document).trigger("reycore/woocommerce/compare/removed_product",[o,t])}},this.removeAll=function(){"undefined"!=typeof Cookies&&Cookies.set(this.cookie_key,"")},this.init()};e(document).one("reycore/init",(function(){e.reyCompare=new t}))}(jQuery);